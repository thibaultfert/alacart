{% extends 'base.html.twig' %}

{% block title %}{{ product.name }}{% endblock %}

{% block body %}
    <div class="container-fluid h-100">
        <div class="row h-100">
            <div class="col-12 d-flex align-items-center" style="height:10%">
                <h2>{{ product.name }}</h2>
            </div>
            <div class="col-12 col-lg-6 d-flex justify-content-center align-items-center border border-dark rounded" style="height:90%">
                {% if product.numberOfImages is not null %}        
                    <div id="carouselControls" class="carousel slide h-100 w-100 mx-auto" data-ride="carousel" data-interval="false">
                        <ol class="carousel-indicators bg-dark mb-0 mx-auto w-100">
                            {% for i in 0..(product.numberOfImages - 1) %} {# On boulce de 0 à (nbImage - 1) car le data-slide-to doit commencer à 0 #}
                                {% if i == 0 %} {# cas particulier : le premier lien doit avoir la class 'active'#}
                                    <li data-target="#carouselControls" data-slide-to="{{ i }}" class="active"></li>
                                {% else %}
                                    <li data-target="#carouselControls" data-slide-to="{{ i }}"></li>
                                {% endif %}
                            {% endfor %}
                        </ol>
                        <div class="carousel-inner h-100">
                            {% for i in 1..(product.numberOfImages) %} 
                                {% if i == 1 %} {# cas particulier : le premier carousel-item doit avoir la class 'active'#}
                                    <div class="carousel-item active h-100">
                                        <img src="{{ asset('images/' ~ product.images ~ i ~ '.jpg') }}" class="img-fluid d-block carousel_image mx-auto" alt="photo_produit">
                                    </div>                                    
                                {% else %}
                                    <div class="carousel-item h-100">
                                        <img src="{{ asset('images/' ~ product.images ~ i ~ '.jpg') }}" class="img-fluid d-block carousel_image mx-auto" alt="photo_produit">
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <a class="carousel-control-prev d-flex justify-content-start" href="#carouselControls" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon bg-dark rounded" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next d-flex justify-content-end" href="#carouselControls" role="button" data-slide="next">
                            <span class="carousel-control-next-icon bg-dark rounded" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>          
                    </div> 
                {% else %} 
                    <div class="container-fluid text-center">Pas encore d'images pour ce produit</div>
                {% endif %}
            </div> 
            <div class="col-lg-6 d-none d-lg-flex flex-column justify-content-around">
                <div>{{ product.region }}</div>
                <div style="font-style: italic">"{{ product.description }}"</div>
                <div>{{ product.volume }}L</div>
                <div class="row">
                    <div class="col-6 d-flex align-items-end">{{ product.price }}EUR</div>
                    <div class="col-6">
                        <a href="{{ path('cart_add', {'id' : product.id}) }}" class="btn btn-primary">
                        Ajouter à mon panier
                        </a>
                    </div>     
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 d-lg-none my-2">
                <div class="my-1">{{ product.region }}</div>
                <div class="my-1" style="font-style: italic">"{{ product.description }}"</div>
                <div class="my-1">{{ product.volume }}L</div>
                <div class="row my-1">
                    <div class="col-6 d-flex align-items-end"><strong>{{ product.price }}EUR</strong></div>
                    <div class="col-6">
                        <a href="{{ path('cart_add', {'id' : product.id}) }}" class="btn btn-primary">
                        Ajouter à mon panier
                        </a>
                    </div>     
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid border-top border-dark my-2">
        <div class="row">
            <div class="col-12 my-2">
                <h1>Commentaires :</h1>
                {% for productComment in product.productComments %}
                    <div class="comment">
                        <div class="row">
                            <div class="col-3">
                                {{ productComment.author }} (<small>{{ productComment.createdAt | date ('d/m/Y à H:i') }}</small>)
                            </div> 
                            <div class="col-9">
                                {{ productComment.content }}
                            </div>
                        </div>
                    </div>
                    <hr>
                {% endfor %}
            </div>
        </div>
        <div class="row">
            <div class="col-12 my-2">
                {% if app.user %}
                    <h1>Ajouter un commentaire</h1>
                    {{ form_start(productCommentForm, {'action': path('product_add_comment', { 'id' : product.id, 'type' : product.type, 'userId' : app.user.id })}) }}
                    {{ form_row(productCommentForm.content, {'label': 'Commentaire'})}}
                    <button class="btn btn-success">Envoyer</button>
                    {{ form_end(productCommentForm) }}

                {% else %}
                    <h4 class="my-2">Pour laisser un commentaire, merci de vous connecter</h4>
                    <a  href="{{ path('security_login') }}"><button class="btn btn-secondary my-2">Se connecter</button></a>
                {% endif %}
            </div>
        </div>
    </div>


{% endblock %}